<script setup lang="ts">
// @TODO change to useState
const { menuActive, toggleMenuActive } = useSimpleState()

// Route change handler
const route = useRoute()

// Set active menu item
watch(
  () => route.name,
  () => {
    menuActive.value = false;
  }
);

const links = reactive([
  {
    to: '/',
    label: 'Latest'
  },
  {
    to: '/artists',
    label: 'Artists'
  },
  {
    to: '/releases',
    label: 'Releases'
  },
  {
    to: '/contact',
    label: 'Contact'
  }
])
</script>

<template>
  <button
    :class="menuActive ? 'active' : null"
    @click="toggleMenuActive"
  >
    <span class="sr-only">{{ !menuActive ? "Open menu" : "Close menu" }}</span>
    <!-- prettier-ignore -->
    <svg
      class="menu-hamburger menu-hamburger--close"
      height="19"
      viewBox="0 0 70 19"
      width="70"
      xmlns="http://www.w3.org/2000/svg"
    ><path
      d="m8.211 18.23c1.9166667 0 3.4768333-.3296667 4.6805-.989s2.0585-1.5793333 2.5645-2.76c-1.748-.368-3.2736667-.805-4.577-1.311-.3373333.3833333-.7053333.6708333-1.104.8625-.39866667.1916667-.851.2875-1.357.2875-.92 0-1.61383333-.2376667-2.0815-.713s-.71683333-1.104-.7475-1.886c.03066667-.782.27983333-1.4106667.7475-1.886.46766667-.47533333 1.1615-.713 2.0815-.713.506 0 .95833333.09583333 1.357.2875.3986667.19166667.7666667.47916667 1.104.8625 1.6866667-.58266667 3.2123333-1.01966667 4.577-1.311-.506-1.18066667-1.3608333-2.10066667-2.5645-2.76s-2.7638333-.989-4.6805-.989c-2.56066667 0-4.45433333.598-5.681 1.794s-1.84 2.76766667-1.84 4.715c0 1.9473333.61333333 3.519 1.84 4.715s3.12033333 1.794 5.681 1.794zm13.7030047-.23c-.0270588-.9064706-.0421799-2.3023875-.0453633-4.1877509l.0002833-1.8621691c.0024534-1.3640533.0098134-2.41408.02208-3.15008-.0129743-.62276923-.0204595-1.53097436-.0224556-2.72461538l-.0002722-1.00492308c.0021775-1.33046154.0174201-3.00061539.0457278-5.01046154h-5.428l.023 2.484c.0306667 2.69866667.046 4.784.046 6.256 0 1.5486667-.0153333 3.749-.046 6.601l-.023 2.599zm8.5510047.23c2.6526667 0 4.6345-.598 5.9455-1.794s1.9665-2.783 1.9665-4.761c0-1.2113333-.2836666-2.30383333-.851-3.2775-.5673333-.97366667-1.4451666-1.748-2.6335-2.323-1.1883333-.575-2.6641666-.8625-4.4275-.8625-2.622 0-4.5501666.598-5.7845 1.794-1.2343333 1.196-1.8515 2.75233333-1.8515 4.669 0 1.9626667.6171667 3.5458333 1.8515 4.7495 1.2343334 1.2036667 3.1625 1.8055 5.7845 1.8055zm.092-3.91c-.9966666 0-1.725-.2376667-2.185-.713s-.69-1.1116667-.69-1.909c0-.7666667.23-1.3876667.69-1.863.46-.47533333 1.1883334-.713 2.185-.713.9966667 0 1.7403334.2415 2.231.7245.4906667.483.736 1.1001667.736 1.8515 0 .7973333-.2453333 1.4336667-.736 1.909-.4906666.4753333-1.2343333.713-2.231.713zm16.1640048 3.91c2.2693333 0 4.048-.3718333 5.336-1.1155s1.932-1.9435 1.932-3.5995c0-1.104-.437-1.9243333-1.311-2.461s-2.1083334-.805-3.703-.805c-.552 0-1.3876667.0383333-2.507.115-.46.046-.8203334.069-1.081.069-.2606667 0-.4715-.0613333-.6325-.184s-.2415-.29133333-.2415-.506c0-.276.1916666-.52133333.575-.736.3833333-.21466667.8433333-.322 1.38-.322.7666666 0 1.5295.09583333 2.2885.2875s1.5755.5175 2.4495.9775l2.645-2.668c-.9506667-.69-2.0431667-1.2075-3.2775-1.5525-1.2343334-.345-2.4571667-.5175-3.6685-.5175-2.4686667 0-4.3393334.37183333-5.612 1.1155-1.2726667.74366667-1.909 1.79016667-1.909 3.1395 0 1.1653333.4255 2.0048333 1.2765 2.5185s1.9588333.7705 3.3235.7705c.8433333 0 1.6636666-.046 2.461-.138.1533333-.0153333.3565-.0306667.6095-.046s.4791666-.023.6785-.023c.322 0 .575.069.759.207s.276.3296667.276.575c0 .3066667-.1878334.5558333-.5635.7475-.3756667.1916667-.9085.2875-1.5985.2875-.7206667 0-1.5793334-.1418333-2.576-.4255-.9966667-.2836667-1.8476667-.6785-2.553-1.1845l-2.415 3.289c1.1653333.736 2.4111666 1.2841667 3.7375 1.6445 1.3263333.3603333 2.6335.5405 3.9215.5405zm15.6120047 0c2.0086667 0 3.6378333-.3181667 4.8875-.9545s2.1121667-1.4911667 2.5875-2.5645c-1.702-.5826667-3.0666667-1.127-4.094-1.633-.3373333.46-.7896667.8165-1.357 1.0695s-1.173.3795-1.817.3795c-.8893333 0-1.5755-.2108333-2.0585-.6325s-.7858333-.9698333-.9085-1.6445h10.35c.0306667-.1993333.046-.4983333.046-.897 0-1.196-.3066667-2.25783333-.92-3.1855s-1.495-1.65216667-2.645-2.1735-2.507-.782-4.071-.782c-2.622 0-4.554.598-5.796 1.794s-1.863 2.75233333-1.863 4.669c0 1.9626667.6248333 3.5458333 1.8745 4.7495s3.1778333 1.8055 5.7845 1.8055zm2.829-7.912h-5.428c.1993333-.506.5443333-.90466667 1.035-1.196s1.1193333-.437 1.886-.437c.6593333 0 1.196.1495 1.61.4485s.713.69383333.897 1.1845z"
      fill="#211202"
    /></svg>
    <!-- prettier-ignore -->
    <svg
      class="menu-hamburger menu-hamburger--open"
      height="14"
      viewBox="0 0 70 14"
      width="70"
      xmlns="http://www.w3.org/2000/svg"
    ><path
      d="m5.532 13c-.06133333-1.242-.092-2.3843333-.092-3.427 0-.49066667.01533333-1.31866667.046-2.484.06133333-.782.27216667-1.39916667.6325-1.8515s.80883333-.6785 1.3455-.6785c.506 0 .92383333.19933333 1.2535.598s.4945.93533333.4945 1.61c0 1.90133333-.046 3.979-.138 6.233h5.175c-.0766667-1.1346667-.115-3.059-.115-5.773v.023c0-.874.1878333-1.541.5635-2.001s.8241667-.69 1.3455-.69c.5673333 0 1.0235.1955 1.3685.5865s.5175.9315.5175 1.6215c0 2.14666667-.0613333 4.2243333-.184 6.233h5.359c-.0265778-.6777333-.0416385-1.7124948-.0451822-3.10428444l-.0008178-4.48571556c0-1.61-.391-2.87883333-1.173-3.8065s-1.863-1.3915-3.243-1.3915c-1.058 0-2.001.322-2.829.966s-1.4183333 1.51033333-1.771 2.599c-.184-1.058-.6555-1.91666667-1.4145-2.576s-1.7365-.989-2.9325-.989c-.99666667 0-1.87833333.29516667-2.645.8855s-1.32633333 1.5065-1.679 2.7485l-.69-3.404c-.98133333.046-1.75566667.069-2.323.069-.53666667 0-1.311-.023-2.323-.069.12266667 2.23866667.184 4.33933333.184 6.302s-.06133333 4.048-.184 6.256zm26.3760047.23c2.0086667 0 3.6378334-.3181667 4.8875-.9545 1.2496667-.6363333 2.1121667-1.4911667 2.5875-2.5645-1.702-.58266667-3.0666666-1.127-4.094-1.633-.3373333.46-.7896666.8165-1.357 1.0695-.5673333.253-1.173.3795-1.817.3795-.8893333 0-1.5755-.21083333-2.0585-.6325s-.7858333-.96983333-.9085-1.6445h10.35c.0306667-.19933333.046-.49833333.046-.897 0-1.196-.3066666-2.25783333-.92-3.1855-.6133333-.92766667-1.495-1.65216667-2.645-2.1735s-2.507-.782-4.071-.782c-2.622 0-4.554.598-5.796 1.794s-1.863 2.75233333-1.863 4.669c0 1.96266667.6248334 3.5458333 1.8745 4.7495 1.2496667 1.2036667 3.1778334 1.8055 5.7845 1.8055zm2.829-7.912h-5.428c.1993334-.506.5443334-.90466667 1.035-1.196.4906667-.29133333 1.1193334-.437 1.886-.437.6593334 0 1.196.1495 1.61.4485s.713.69383333.897 1.1845zm11.2190047 7.682c-.0613333-1.242-.092-2.3843333-.092-3.427 0-.49066667.0153334-1.31866667.046-2.484.0613334-.782.2683334-1.39916667.621-1.8515.3526667-.45233333.782-.6785 1.288-.6785s.9238334.19933333 1.2535.598c.3296667.39866667.4945.93533333.4945 1.61 0 1.90133333-.046 3.979-.138 6.233h5.175c-.0766666-1.2266667-.115-2.8596667-.115-4.899v-3.312c0-.85866667-.1725-1.633-.5175-2.323s-.8548333-1.23816667-1.5295-1.6445c-.6746666-.40633333-1.472-.6095-2.392-.6095-.9966666 0-1.8706666.29516667-2.622.8855-.7513333.59033333-1.3033333 1.49883333-1.656 2.7255l-.667-3.381c-.9813333.046-1.7556666.069-2.323.069-.5366666 0-1.311-.023-2.323-.069.1226667 2.23866667.184 4.33933333.184 6.302s-.0613333 4.048-.184 6.256zm14.3470048.23c.9966666 0 1.8706666-.2951667 2.622-.8855.7513333-.5903333 1.3033333-1.4988333 1.656-2.7255l.667 3.381c1.012-.046 1.7863333-.069 2.323-.069.5673333 0 1.3416666.023 2.323.069-.1073334-1.9473333-.161-4.048-.161-6.302 0-2.23866667.0536666-4.324.161-6.256h-5.497c.0613333 1.288.092 2.461.092 3.519 0 .46-.0153334 1.288-.046 2.484v.529c-.0766667.736-.2951667 1.31483333-.6555 1.7365-.3603334.42166667-.7781667.6325-1.2535.6325-.506 0-.9238334-.19933333-1.2535-.598-.3296667-.39866667-.4945-.93533333-.4945-1.61 0-2.208.046-4.439.138-6.693h-5.175c.0766666 1.22666667.115 2.85966667.115 4.899v3.312c0 .85866667.1725 1.633.5175 2.323s.8548333 1.2381667 1.5295 1.6445c.6746666.4063333 1.472.6095 2.392.6095z"
      fill="#211202"
    /></svg>
    <!-- prettier-ignore -->
    <svg
      class="menu-hamburger menu-hamburger--bar-1"
      height="15"
      viewBox="0 0 72 15"
      width="72"
      xmlns="http://www.w3.org/2000/svg"
    ><path
      d="m43.0597241 43.013638c-.08-4.065812-.12-10.6196581-.12-19.6615385 0-.2786957.0000275-.5547278.0000823-.828096l.0006585-1.6082446c.0039506-6.3051176.0237037-11.07591007.0592592-14.3123773-.0347826-2.53288741-.0544423-6.25880148-.0589792-11.17774224l-.0009074-1.51147302-.0001134-.78257962c0-5.46153842.04-12.50085472.12-21.11794872h-14.16l.06 9.8307692c.0746667 9.96831913.1144889 17.82214629.1194667 23.56148152l.0000338 2.41596722c-.0048283 6.04494876-.0446618 14.34691026-.1195005 24.90588466l-.06 10.2858974z"
      fill="#211202"
      transform="matrix(0 -1 1 0 28.466086 43.493362)"
    /></svg>
    <!-- prettier-ignore -->
    <svg
      class="menu-hamburger menu-hamburger--bar-2"
      height="15"
      viewBox="0 0 72 15"
      width="72"
      xmlns="http://www.w3.org/2000/svg"
    ><path
      d="m43.0597241 43.013638c-.08-4.065812-.12-10.6196581-.12-19.6615385 0-.2786957.0000275-.5547278.0000823-.828096l.0006585-1.6082446c.0039506-6.3051176.0237037-11.07591007.0592592-14.3123773-.0347826-2.53288741-.0544423-6.25880148-.0589792-11.17774224l-.0009074-1.51147302-.0001134-.78257962c0-5.46153842.04-12.50085472.12-21.11794872h-14.16l.06 9.8307692c.0746667 9.96831913.1144889 17.82214629.1194667 23.56148152l.0000338 2.41596722c-.0048283 6.04494876-.0446618 14.34691026-.1195005 24.90588466l-.06 10.2858974z"
      fill="#211202"
      transform="matrix(0 -1 1 0 28.466086 43.493362)"
    /></svg>
  </button>

  <teleport to="body">
    <transition name="slide">
      <dialog
        v-if="menuActive"
        class="overlay"
        :open="menuActive"
      >
        <aside>
          <nav>
            <ul role="list">
              <li
                v-for="(link, count) in links"
                :key="`link--${count}`"
                role="listitem"
                class="nav__item"
              >
                <nuxt-link
                  :to="link.to"
                  :class="'nav__link'"
                  @click="menuActive = false"
                >
                  {{ link.label }}
                </nuxt-link>
              </li>
            </ul>
          </nav>
        </aside>
      </dialog>
    </transition>
  </teleport>
</template>

<style scoped>
.menu-hamburger--close {
  margin-bottom: 1em;
}

.menu-hamburger--open {
  margin-bottom: 1em;
}

.menu-hamburger--bar-1 {
  margin-bottom: 1em;
}

button {
  all: unset;
  height: 78px;
  background: none;
  border: none;
  cursor: pointer;
  align-self: start;
  justify-self: end;
  transform: scale(0.6);
  transform-origin: right;
  transition: 0.3s ease;
  /* Higher than <dialog> */
  z-index: 1000;
}

button svg {
  display: block;
  transition: 0.2s ease;
}

button svg path {
  fill: var(--primary);
  transition: 0.3s ease;
}

button.active svg path {
  fill: var(--primary-inverse);
}

button:not(.active) .menu-hamburger--close {
  display: none;
}

button.active .menu-hamburger--bar-1 {
  display: none;
}

button.active .menu-hamburger--bar-2 {
  transform: translateY(calc(-14px - 1em));
}

button.active .menu-hamburger--open {
  transform: translateY(calc(14px + 1em));
}

.overlay {
  transition: 0.5s ease;
  width: 100vw;
  height: 100vh;
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background-color: var(--primary);
  color: var(--background-color);
}

.slide-enter-active,
.slide-leave-active {
  transition: transform 0.3s ease;
  transform: translateX(0%);
}

.slide-enter-from {
  transition: transform 0.3s ease;
  transform: translateX(100%);
}

.slide-leave-to {
  transition: transform 0.3s ease;
  transform: translateX(-100%);
}

.nav__link {
  color: var(--primary-inverse);
  font-size: 2rem;
}

.nav__link.router-link-active:before {
  content: "\2192";
}
</style>
